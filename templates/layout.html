<!DOCTYPE html>
<html lang="{{ current_lang }}"> <!-- Динамический язык -->
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta property="og:type" content="website">
    <meta property="og:site_name" content="{{ _('page_title') }}"> <!-- Перевод -->
    <meta property="og:title" content="{{ _('og_title') }}"> <!-- Новый ключ для OG -->
    <meta property="og:description" content="{{ _('og_description') }}"> <!-- Новый ключ для OG -->
    <meta property="og:image" content="https://hi.johnlarckin.com/static/img/preview.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:url" content="{{ request.url_root }}{{ current_lang }}/"> <!-- Динамический URL -->

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ _('twitter_title') }}"> <!-- Новый ключ -->
    <meta name="twitter:description" content="{{ _('twitter_description') }}"> <!-- Новый ключ -->
    <meta name="twitter:image" content="https://hi.johnlarckin.com/static/img/preview.png">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/global.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/grid.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/card.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/container.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/hero.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/side.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fonts.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/header.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/faq.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ui.css') }}">

    <title>{{ _('page_title') }}</title> <!-- Динамический title -->

    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

        ym(100975624, "init", {
             clickmap:true,
             trackLinks:true,
             accurateTrackBounce:true,
             webvisor:true,
             defer: true // Небольшое улучшение - отложить инициализацию
        });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/100975624" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

    <style>
        html.lenis { height: auto; }
        .lenis.lenis-smooth { scroll-behavior: auto !important; }
        .lenis.lenis-stopping iframe { pointer-events: none; }

        html {
            scroll-behavior: smooth;
        }

        .animate-on-scroll {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
            will-change: opacity, transform;
        }

        .animate-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        .animation-trigger {}

        /* Стили для переключателя языков (пример) */
        .language-switcher {
            position: fixed; /* Или другое позиционирование */
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.8);
            padding: 5px;
            border-radius: 5px;
        }
        .language-switcher a {
            text-decoration: none;
            padding: 5px 8px;
            color: #333;
            font-weight: bold;
            text-transform: uppercase;
        }
        .language-switcher a.active {
            color: #007bff; /* Или ваш активный цвет */
            pointer-events: none; /* Нельзя кликнуть на активный язык */
            cursor: default;
        }

    </style>

</head>

<body>

    <!-- Пример переключателя языков -->
    <div class="language-switcher">
        {% for lang in supported_langs %}
            {# Создаем копию request.view_args, чтобы не изменять оригинал #}
            {% set view_args = request.view_args.copy() %}
            {# Обновляем или добавляем lang_code в копии словаря #}
            {% set _ = view_args.update({'lang_code': lang}) %}
            {# Используем обновленный словарь view_args для генерации URL #}
            <a href="{{ url_for(request.endpoint, **view_args) }}"
               class="{{ 'active' if lang == current_lang else '' }}">
                {{ lang }}
            </a>
        {% endfor %}
    </div>
    <!-- Конец примера -->


    <section class="base">

        <section class="aside--base">
             <!-- Передаем язык в header, если там тоже есть переводы -->
            {% include 'header.html' %}
        </section>

        <section class="bside--base gp gp--xs">
            {% block main %}
            {% endblock %}

             <!-- Передаем язык в faq, если там тоже есть переводы -->
            <section class="faq pd pd__hg gp gp--xxl animation-trigger" id="faq">
                {% include 'faq.html' %}
            </section>

             <!-- Передаем язык в footer, т.к. там точно есть переводы -->
            <footer class="gp gp--xxl animation-trigger">
                {% include 'footer.html' %}
            </footer>

        </section>

    </section>

    <script src="https://cdn.jsdelivr.net/npm/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>

    <script>
        // --- Lenis Smooth Scroll ---
        const lenis = new Lenis()
        function raf(time) {
          lenis.raf(time)
          requestAnimationFrame(raf)
        }
        requestAnimationFrame(raf)

        // --- Intersection Observer for Animations ---
        document.addEventListener('DOMContentLoaded', () => {
            const animationTriggers = document.querySelectorAll('.animation-trigger');
            const staggerDelay = 100; // мс

            if (!animationTriggers.length) return;

            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.1
            };

            const observerCallback = (entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const triggerElement = entry.target;
                        const elementsToAnimate = triggerElement.querySelectorAll('.animate-on-scroll');

                        elementsToAnimate.forEach((el, index) => {
                            setTimeout(() => {
                                el.classList.add('is-visible');
                            }, index * staggerDelay);
                        });

                        observer.unobserve(triggerElement);
                    }
                });
            };

            const observer = new IntersectionObserver(observerCallback, observerOptions);

            animationTriggers.forEach(trigger => {
                observer.observe(trigger);
            });
        });
    </script>

</body>
</html>